steps:
  - command: |
      export PATH=$$PATH:/usr/local/miniconda/bin:/usr/local/bin
      echo $$PATH
      export LD_LIBRARY_PATH=$$LD_LIBRARY_PATH:/usr/local/lib
      echo $$LD_LIBRARY_PATH
      source /cad/modules/tcl/init/bash
      module load base xcelium vcs
      conda create -p ./conda_env -m -y pip python=3.7.4
      export PATH=$$PWD/conda_env/bin:$$PATH
      pip install -e .
      pip install pytest
      pytest tests/test_ops.py::test_xrun tests/test_ops.py::test_vcs tests/test_hier.py::test_xrun tests/test_hier.py::test_vcs
    label: "test"
    timeout_in_minutes: 60
    agents:
      butterphy: "true"
  - command: |
      source /etc/environment
      echo $$PATH
      python3.7 -m venv venv
      source venv/bin/activate
      pip install pytest
      pip install -e .
      pytest tests/test_ops.py::test_vivado tests/test_hier.py::test_vivado tests/test_synth.py
      deactivate
    label: "test_emu"
    timeout_in_minutes: 60
    agents:
        fpga_verif: "true"
